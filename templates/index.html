<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plex Suggester</title>
  <!-- Add modern fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      color: #fff;
      background-color: #1a1a1a;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      font-weight: 400;
    }

    .overlay {
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(26, 26, 26, 0.9) 100%);
      backdrop-filter: blur(8px);
      min-height: 100vh;
      padding: 1.5em;
      text-align: center;
    }

    h1 {
      color: #e5a00d;
      font-size: 2.5em;
      margin-bottom: 0.5em;
      text-shadow: 0 2px 12px rgba(229, 160, 13, 0.3);
    }

    .top-buttons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5em;
      margin-bottom: 2.5em;
      flex-wrap: wrap;
    }

    .watch-plex-container {
      display: flex;
      align-items: center;
      gap: 0.8em;
      background: rgba(229, 160, 13, 0.1);
      padding: 0.8em 1.2em;
      border-radius: 12px;
      border: 1px solid rgba(229, 160, 13, 0.2);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .watch-plex-container:hover {
      background: rgba(229, 160, 13, 0.15);
      border-color: rgba(229, 160, 13, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(229, 160, 13, 0.15);
    }

    .watch-count-display {
      display: flex;
      align-items: center;
      gap: 0.4em;
      color: #e5a00d;
      font-weight: 600;
      font-size: 0.95em;
      padding: 0.4em 0.8em;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      border: 1px solid rgba(229, 160, 13, 0.3);
      transition: all 0.3s ease;
    }

    .watch-count-display:hover {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(229, 160, 13, 0.5);
    }

    .btn {
      background: linear-gradient(135deg, #e5a00d 0%, #ffbe3c 100%);
      color: #000;
      border: none;
      font-size: 1em;
      font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 0.85em 1.4em;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(229, 160, 13, 0.2);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.025em;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      background: linear-gradient(135deg, #ffbe3c 0%, #ffd700 100%);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(229, 160, 13, 0.3);
    }

    .watch-btn {
      background: linear-gradient(135deg, #e5a00d 0%, #ff9500 100%);
    }

    .watch-btn:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ffb347 100%);
    }

    .suggest-another-container {
      display: flex;
      align-items: center;
    }

    .suggest-btn {
      background: linear-gradient(135deg, #4a4a4a 0%, #6a6a6a 100%);
      color: #e5a00d;
      border: 1px solid rgba(229, 160, 13, 0.3);
    }

    .suggest-btn:hover {
      background: linear-gradient(135deg, #5a5a5a 0%, #7a7a7a 100%);
      border-color: rgba(229, 160, 13, 0.5);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(229, 160, 13, 0.2);
    }

    .poster {
      max-width: 280px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(229, 160, 13, 0.3);
      margin: 1.5em auto;
      display: block;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .poster:hover {
      transform: scale(1.02);
      box-shadow: 0 15px 50px rgba(229, 160, 13, 0.4);
    }

    .movie-title {
      font-size: 2.2em;
      margin: 1.2em 0 0.8em 0;
      font-weight: 700;
      text-shadow: 0 3px 15px rgba(0, 0, 0, 0.8);
      line-height: 1.2;
      background: linear-gradient(135deg, #fff 0%, #e5a00d 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      display: inline-block;
    }

    .movie-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 2px;
      background: linear-gradient(90deg, transparent, #e5a00d, transparent);
      border-radius: 1px;
    }

    .summary {
      max-width: 950px;
      margin: 2em auto;
      font-size: 1.15em;
      line-height: 1.7;
      color: #e8e8e8;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(26, 26, 26, 0.6) 100%);
      padding: 2em 2.5em;
      border-radius: 16px;
      border: 1px solid rgba(229, 160, 13, 0.15);
      backdrop-filter: blur(15px);
      position: relative;
      box-shadow: 0 8px 35px rgba(0, 0, 0, 0.3);
    }

    .summary::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 16px;
      padding: 1px;
      background: linear-gradient(135deg, rgba(229, 160, 13, 0.3) 0%, transparent 50%, rgba(229, 160, 13, 0.1) 100%);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask-composite: exclude;
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
    }

    .summary::after {
      content: '"';
      position: absolute;
      top: 15px;
      left: 20px;
      font-size: 3em;
      color: rgba(229, 160, 13, 0.3);
      font-family: Georgia, serif;
      line-height: 1;
    }

    .cast {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 2em;
      margin: 3em 0;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 1em;
    }

    .cast-header {
      margin: 2.5em 0 1.5em 0;
      color: #e5a00d;
      font-size: 1.8em;
      font-weight: 600;
      text-shadow: 0 2px 8px rgba(229, 160, 13, 0.3);
      position: relative;
    }

    .cast-header::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, transparent, #e5a00d, transparent);
      border-radius: 2px;
    }

    .actor {
      text-align: center;
      transition: all 0.3s ease;
      background: rgba(0, 0, 0, 0.2);
      padding: 1.5em 1em;
      border-radius: 15px;
      border: 1px solid rgba(229, 160, 13, 0.1);
      backdrop-filter: blur(10px);
    }

    .actor:hover {
      transform: translateY(-8px);
      background: rgba(0, 0, 0, 0.3);
      border-color: rgba(229, 160, 13, 0.3);
      box-shadow: 0 12px 35px rgba(229, 160, 13, 0.15);
    }

    .actor img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 50%;
      border: 3px solid #e5a00d;
      background: #222;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      margin-bottom: 1em;
      transition: all 0.3s ease;
      position: relative;
    }

    .actor img::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(229, 160, 13, 0.1) 0%, transparent 50%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .actor:hover img {
      border-color: #ffbe3c;
      box-shadow: 0 12px 35px rgba(229, 160, 13, 0.4);
      transform: scale(1.05);
    }

    .actor:hover img::after {
      opacity: 1;
    }

    .actor-name {
      font-weight: 600;
      font-size: 1em;
      margin-top: 0.5em;
      color: #fff;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
      line-height: 1.3;
    }

    .trailer-container {
      display: flex;
      align-items: center;
    }

    .trailer-btn {
      background: linear-gradient(135deg, #8b5a2b 0%, #a0672a 100%);
      color: #fff;
      border: 1px solid rgba(229, 160, 13, 0.3);
    }

    .trailer-btn:hover {
      background: linear-gradient(135deg, #a0672a 0%, #b5742d 100%);
      border-color: rgba(229, 160, 13, 0.5);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(229, 160, 13, 0.2);
    }

    .header-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 2.5em;
      position: relative;
      padding: 0 1em;
    }

    .github-link {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 3;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(229, 160, 13, 0.2);
      border-radius: 12px;
      padding: 0.8em;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .github-link:hover {
      background: rgba(0, 0, 0, 0.5);
      border-color: rgba(229, 160, 13, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(229, 160, 13, 0.15);
    }

    .github-link svg {
      width: 24px;
      height: 24px;
      fill: #e5a00d;
      transition: fill 0.3s ease;
    }

    .github-link:hover svg {
      fill: #ffbe3c;
    }

    .header-bar h1 {
      color: #e5a00d;
      font-size: 2.5em;
      margin: 0 auto;
      flex: 0 1 auto;
      width: 100%;
      font-family: 'Poppins', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      font-weight: 700;
      letter-spacing: 2px;
      text-shadow: 0 2px 15px rgba(229, 160, 13, 0.4);
      text-align: center;
      position: absolute;
      left: 0;
      right: 0;
      pointer-events: none;
      z-index: 1;
    }

    .header-bar form {
      margin-left: auto;
      z-index: 2;
      position: relative;
      pointer-events: auto;
    }

    .header-bar select {
      padding: 0.8em 1.5em;
      border-radius: 12px;
      border: 1px solid rgba(229, 160, 13, 0.25);
      font-size: 1em;
      background: rgba(26, 26, 26, 0.95);
      color: #e5a00d;
      font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
      font-weight: 500;
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(15px);
      transition: all 0.3s ease;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5a00d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1em center;
      background-size: 1em;
      padding-right: 3em;
      min-width: 200px;
    }

    .header-bar select:hover {
      background: rgba(26, 26, 26, 1);
      border-color: rgba(229, 160, 13, 0.5);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
      transform: translateY(-2px);
    }

    .header-bar select:focus {
      outline: none;
      border-color: rgba(229, 160, 13, 0.7);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5), 0 0 0 3px rgba(229, 160, 13, 0.1);
    }

    .header-bar select option {
      background: #1a1a1a;
      color: #e5a00d;
      padding: 0.5em;
      border: none;
    }

    #like-dislike {
      margin: 2em 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5em;
      flex-wrap: wrap;
      background: rgba(0, 0, 0, 0.15);
      padding: 1em 1.5em;
      border-radius: 12px;
      border: 1px solid rgba(229, 160, 13, 0.15);
      backdrop-filter: blur(10px);
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    #like-count, #dislike-count {
      color: #e5a00d;
      font-weight: 600;
      font-size: 1.1em;
      margin-left: 0.5em;
      padding: 0.3em 0.8em;
      background: rgba(229, 160, 13, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(229, 160, 13, 0.2);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .overlay {
        padding: 1em;
      }

      .header-bar h1 {
        font-size: 2em;
        letter-spacing: 1px;
      }

      .header-bar {
        flex-direction: column;
        gap: 1.5em;
        position: static;
      }

      .header-bar h1 {
        position: static;
        margin-bottom: 1em;
      }

      .header-bar form {
        margin: 0;
      }

      .github-link {
        position: static;
        margin-bottom: 1em;
      }

      .github-link svg {
        width: 20px;
        height: 20px;
      }

      .top-buttons {
        flex-direction: column;
        gap: 1em;
      }

      .watch-plex-container {
        flex-direction: column;
        gap: 0.8em;
        padding: 1em;
        max-width: 90%;
      }

      .suggest-another-container {
        width: 100%;
        display: flex;
        justify-content: center;
      }

      .cast {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1.5em;
        padding: 0 0.5em;
      }

      .actor {
        padding: 1em 0.5em;
      }

      .actor img {
        width: 100px;
        height: 100px;
      }

      .summary {
        padding: 1.5em;
        margin: 1.5em 0.5em;
        font-size: 1.05em;
      }

      .summary::after {
        font-size: 2.5em;
        top: 10px;
        left: 15px;
      }

      .movie-title {
        font-size: 1.8em;
        margin: 1em 0 0.8em 0;
      }

      .header-bar select {
        min-width: 180px;
        padding: 0.7em 1.2em;
        padding-right: 2.5em;
      }

      #like-dislike {
        flex-direction: row;
        gap: 1em;
        padding: 0.8em 1em;
        max-width: 90%;
      }
    }

    @media (max-width: 480px) {
      .poster {
        max-width: 220px;
      }

      .cast {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1em;
        padding: 0;
      }

      .actor {
        padding: 0.8em 0.3em;
      }

      .actor img {
        width: 80px;
        height: 80px;
      }

      .summary {
        padding: 1.2em;
        margin: 1em 0.3em;
        font-size: 1em;
      }

      .summary::after {
        font-size: 2em;
        top: 8px;
        left: 12px;
      }

      .movie-title {
        font-size: 1.5em;
      }

      .header-bar select {
        min-width: 160px;
        padding: 0.6em 1em;
        padding-right: 2.2em;
        font-size: 0.9em;
      }

      .actor-name {
        font-size: 0.9em;
      }

      .btn {
        padding: 0.7em 1em;
        font-size: 0.9em;
      }
    }

    /* Smooth animations */
    * {
      transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
    }

    /* Loading animation for counts */
    .loading {
      opacity: 0.6;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 0.6;
      }
      50% {
        opacity: 1;
      }
      100% {
        opacity: 0.6;
      }
    }
  </style>
</head>
<body style="background-image: url('{{ movie.poster_url }}');">
  <div class="overlay">
    <div class="header-bar">
      <a href="https://github.com/TheInfamousToTo/plex-suggester" target="_blank" class="github-link" title="View on GitHub">
        <svg viewBox="0 0 24 24">
          <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
        </svg>
      </a>
      <h1>Plex Movie Suggester</h1>
      <form method="get" action="/">
        <select name="library" onchange="this.form.submit()">
          {% for lib in libraries %}
            <option value="{{ lib.title }}" {% if lib.title == selected_library %}selected{% endif %}>
              {{ lib.title }} ({{ lib.type|capitalize }})
            </option>
          {% endfor %}
        </select>
      </form>
    </div>

    <div class="top-buttons">
      {% if movie.watch_url %}
      <div class="watch-plex-container">
        <div class="watch-count-display">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
          </svg>
          <span id="watch-count">0</span>
        </div>
        <a href="{{ movie.watch_url }}" target="_blank" class="btn watch-btn" onclick="trackWatchClick()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
          Watch on Plex
        </a>
      </div>
      {% endif %}

      {% if movie and movie.external_trailer_url %}
      <div class="trailer-container">
        <a href="{{ movie.external_trailer_url }}" target="_blank" class="btn trailer-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 8v8l6-4-6-4zm2-6C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
          </svg>
          Watch Trailer
        </a>
      </div>
      {% endif %}

      <div class="suggest-another-container">
        <form method="get" action="/" style="display:inline;">
          <input type="hidden" name="library" value="{{ selected_library }}">
          <button class="btn suggest-btn" type="submit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
            </svg>
            Suggest Another
          </button>
        </form>
      </div>
    </div>

    {% if error %}
      <p style="color: red;">{{ error }}</p>
    {% elif movie %}
      <img class="poster" src="{{ movie.poster_url or 'https://via.placeholder.com/250x375?text=No+Image' }}" alt="Poster">
      <div class="movie-title">{{ movie.title }}{% if movie.year %} ({{ movie.year }}){% endif %}</div>
      <div class="summary">{{ movie.summary }}</div>

      <!-- Like/Unlike Buttons -->
      <div id="like-dislike">
        <button id="like-btn" class="btn" onclick="likeMovie()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
          </svg>
          Like
        </button>
        <span id="like-count"></span>
        <button id="dislike-btn" class="btn" onclick="dislikeMovie()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2.65l1.45 1.32C18.6 8.64 22 11.72 22 15.5 22 18.58 19.58 21 16.5 21c-1.74 0-3.41-.81-4.5-2.09C10.91 20.19 9.24 21 7.5 21 4.42 21 2 18.58 2 15.5c0-3.78 3.4-6.86 8.55-11.54L12 2.65z"/>
          </svg>
          Dislike
        </button>
        <span id="dislike-count"></span>
      </div>
      <script>
        const API_BASE = "https://plex-like.satrawi.cc";
        const movieKey = "{{ movie.key|e }}";
        function getMovieId(key) {
          const match = key.match(/(\d+)$/);
          return match ? match[1] : key;
        }
        const movieId = getMovieId(movieKey);

        function updateLikeCount() {
          // Add loading class
          document.getElementById('like-count').classList.add('loading');
          document.getElementById('dislike-count').classList.add('loading');
          document.getElementById('watch-count').classList.add('loading');

          fetch(`${API_BASE}/like-count/${encodeURIComponent(movieId)}`)
            .then(r => r.json())
            .then(data => {
              document.getElementById('like-count').textContent = ` ${data.count || 0}`;
              document.getElementById('like-count').classList.remove('loading');
            });
          fetch(`${API_BASE}/dislike-count/${encodeURIComponent(movieId)}`)
            .then(r => r.json())
            .then(data => {
              document.getElementById('dislike-count').textContent = ` ${data.count || 0}`;
              document.getElementById('dislike-count').classList.remove('loading');
            });
          fetch(`${API_BASE}/watch-count/${encodeURIComponent(movieId)}`)
            .then(r => r.json())
            .then(data => {
              document.getElementById('watch-count').textContent = data.count || 0;
              document.getElementById('watch-count').classList.remove('loading');
            });
        }

        function likeMovie() {
          fetch(`${API_BASE}/like/${encodeURIComponent(movieId)}`, {
            method: "POST",
            headers: {
              "Authorization": `Bearer ${JWT_TOKEN}`
            }
          }).then(() => updateLikeCount());
        }

        function dislikeMovie() {
          fetch(`${API_BASE}/dislike/${encodeURIComponent(movieId)}`, {
            method: "POST",
            headers: {
              "Authorization": `Bearer ${JWT_TOKEN}`
            }
          }).then(() => updateLikeCount());
        }

        function trackWatchClick() {
          fetch(`${API_BASE}/watch/${encodeURIComponent(movieId)}`, {
            method: "POST",
            headers: {
              "Authorization": `Bearer ${JWT_TOKEN}`
            }
          }).then(() => updateLikeCount());
        }

        // Initial load
        updateLikeCount();
      </script>

      {% if movie.cast %}
      <h3 class="cast-header">Top Cast</h3>
      <div class="cast">
        {% for actor in movie.cast %}
          <div class="actor">
            {% if actor.thumb %}
              <img src="{{ actor.thumb }}" alt="{{ actor.name }}">
            {% else %}
              <img src="https://via.placeholder.com/120x120/222222/e5a00d?text=?" alt="No Image">
            {% endif %}
            <div class="actor-name">{{ actor.name }}</div>
          </div>
        {% endfor %}
      </div>
      {% endif %}

    {% else %}
      <p>No movie found.</p>
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jsrsasign@10.8.7/lib/jsrsasign-all-min.js"></script>
  <script>
  // Generate a UUID (RFC4122 version 4)
  function generateUUID() {
    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
      (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
    );
  }

  // Get or create user ID
  function getUserId() {
    let userId = localStorage.getItem('plex_suggester_user_id');
    if (!userId) {
      userId = generateUUID();
      localStorage.setItem('plex_suggester_user_id', userId);
    }
    return userId;
  }
  const USER_ID = getUserId();

  async function fetchJWT(userId) {
    const res = await fetch(`https://plex-like.satrawi.cc/get-jwt?user_id=${encodeURIComponent(userId)}`);
    const data = await res.json();
    return data.token;
  }

  let JWT_TOKEN = null;

  fetchJWT(USER_ID).then(token => {
    JWT_TOKEN = token;
    // Now you can use JWT_TOKEN in your API calls
  });
  </script>
</body>
</html>
